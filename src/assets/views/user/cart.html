<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Carrito | Ballers</title>
  <!-- est√°s en: src/assets/views/user/ -->
  <link rel="stylesheet" href="../../css/base.css"/>
</head>
<body>
  <!-- Header (usuario) -->
  <header class="header">
    <div class="container header__inner">
      <a class="logo" href="../../../../index.html">Ballers <span aria-hidden="true">üèÄüëü</span></a>

      <button class="nav__toggle" aria-expanded="false" aria-controls="mainnav">‚ò∞</button>
      <nav id="mainnav" class="nav">
        <ul>
          <li><a href="index.html">Inicio</a></li>
          <li><a href="catalog_user.html">Cat√°logo</a></li>
          <li><a class="active" href="cart.html" aria-current="page">Carrito</a></li>
          <li><a href="comprados.html">Ver productos comprados</a></li>
          <li><a href="seguimiento.html">Seguimiento</a></li>
          <li><a href="editar.html">Editar informaci√≥n</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container" style="padding:22px 0 64px">
    <section class="section">
      <h2 style="margin:0 0 8px">Carrito</h2>

      <div id="cart-list"></div>
      <div id="cart-total" style="margin-top:14px;font-weight:800"></div>
      <p id="cart-msg" class="muted" style="margin-top:10px"></p>
    </section>
  </main>

  <footer class="footer">
    <div class="container footer__inner">
      <small>¬© 2025 Ballers. Todos los derechos reservados.</small>
      <nav aria-label="Legal">
        <a href="#">T√©rminos</a>
        <a href="#">Privacidad</a>
        <a href="#">Contacto</a>
      </nav>
    </div>
  </footer>

  <script src="../../js/app.js"></script>
  <script>
  (async () => {
    const listEl  = document.getElementById('cart-list');
    const totalEl = document.getElementById('cart-total');
    const msgEl   = document.getElementById('cart-msg');

    // 1) Cargar productos
    let products = [];
    try {
      const res = await fetch('../../data/products.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('No se pudo cargar products.json');
      products = await res.json();
    } catch (err) {
      listEl.innerHTML = `<article class="card" style="padding:16px">
        <h3>Error</h3><p class="muted">${err.message}</p>
      </article>`;
      return;
    }

    // 2) Carrito de ejemplo (3 items)
    const cart = products.slice(0, 3).map(p => ({
      id: String(p.id),
      name: p.name,
      price: p.price,
      image: p.image,
      qty: 1
    }));

    const money = n => Number(n).toLocaleString('es-MX', { style:'currency', currency:'MXN' });

    // Rutas de imagen compatibles local/GitHub Pages
    const fixImg = (path) => {
      if (!path) return '';
      if (/^https?:\/\//i.test(path)) return path;                 // URL absoluta
      if (path.startsWith('../img/')) return '../../' + path.replace('../','');
      if (path.startsWith('src/assets/img/')) return '../../' + path.replace('src/assets/','');
      if (path.startsWith('/src/assets/')) return '../../' + path.replace('/src/assets/',''); // quitar slash inicial
      return path; // ya relativa correcta
    };

    function rowTemplate(item){
      const bg = item.image
        ? `linear-gradient(135deg, rgba(255,106,0,.14), rgba(255,209,102,.14)), url('${fixImg(item.image)}') center/cover no-repeat`
        : `linear-gradient(135deg, rgba(255,106,0,.18), rgba(255,209,102,.18)), linear-gradient(160deg,#23232a,#1a1a20)`;
      return `
        <article class="card" data-id="${item.id}" style="display:grid;grid-template-columns:120px 1fr auto;gap:12px;align-items:center">
          <div class="card__img" aria-label="${item.name}" style="height:88px;background:${bg};"></div>
          <div class="card__body">
            <h3 class="card__title" style="margin:0 0 4px">${item.name}</h3>
            <p class="card__price" style="margin:0">${money(item.price)} <span class="muted">x <strong>${item.qty}</strong></span></p>
          </div>
          <div class="card__actions" style="display:flex;gap:8px">
            <button class="btn btn--ghost" data-act="dec">‚Äì</button>
            <button class="btn btn--ghost" data-act="inc">+</button>
            <button class="btn" data-act="del">Eliminar</button>
          </div>
        </article>`;
    }

    function render(){
      if (!cart.length){
        listEl.innerHTML = `<article class="card" style="padding:16px">
          <h3>Tu carrito est√° vac√≠o</h3>
          <p class="muted">Explora el <a href="catalog_user.html">cat√°logo</a> para agregar productos.</p>
        </article>`;
        totalEl.textContent = '';
        msgEl.textContent = '';
        return;
      }
      listEl.innerHTML = cart.map(rowTemplate).join('');
      const total = cart.reduce((t, i) => t + Number(i.price) * i.qty, 0);
      totalEl.textContent = 'Total: ' + money(total);
    }

    // 3) Controles + / ‚Äì / Eliminar
    listEl.addEventListener('click', (e) => {
      const actBtn = e.target.closest('button[data-act]');
      if (!actBtn) return;
      const act = actBtn.dataset.act;
      const card = e.target.closest('[data-id]');
      const id   = String(card.dataset.id);
      const idx  = cart.findIndex(x => String(x.id) === id);
      if (idx === -1) return;

      if (act === 'inc') cart[idx].qty++;
      if (act === 'dec') cart[idx].qty = Math.max(1, cart[idx].qty - 1);
      if (act === 'del') cart.splice(idx, 1);

      render();
    });

    render();
  })();
  </script>
</body>
</html>
